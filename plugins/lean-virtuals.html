
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Mongoose Plugins Search</title>
    <link rel="stylesheet" href="/public/style.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,700">

    <script type="text/javascript">
      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'https://g0a3nbw0xa.execute-api.us-east-1.amazonaws.com/prod/track', true);
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.onreadystatechange = function() {};
      xhr.send(JSON.stringify({
        path: window.location.pathname,
        hostname: window.location.hostname,
        hash: window.location.hash
      }));
    </script>
  </head>
  <body>
    <div id="wrap">
      
    <script type="text/javascript" src="/public/native.js"></script>
    <link rel="stylesheet" href="/public/inlinecpc.css">
    <link rel="stylesheet" href="/public/highlight.css">
    <link rel="stylesheet" href="/public/plugin.css">
    <style>
      a, a:visited {
        color: #0366d6;
      }
    </style>

    <script>
      _native.init("CK7DT53Y",{
        targetClass: 'native-inline'
      });
    </script>

    <div class="content">
      <div class="toc desktop">
        <h2><a href="/">Mongoose Plugins</a></h2>
        <div>
          <div id="select-plugin"><a class="select-plugin-this-repo" href="./lean-virtuals">mongoose-lean-virtuals</a> <span class="right-arrow"></span><div id="select-plugin-hidden"><a href="./autopopulate">mongoose-autopopulate</a>
<a href="./int32">mongoose-int32</a>
<a href="./double">mongoose-double</a>
<a href="./update-versioning">mongoose-update-versioning</a>
<a href="./lean-getters">mongoose-lean-getters</a></div></div>
        </div>
        <ul>
<li><a href="#usage">Usage</a></li>
<li><a href="#examples">examples</a><ul>
<li><a href="#it-attaches-virtuals-to-result-of-find-findone-findbyid-findbyidandupdate-and-findoneandupdate-if-lean">It attaches virtuals to result of find, findOne, findById, findByIdAndUpdate, and findOneAndUpdate if lean</a></li>
<li><a href="#it-lets-you-choose-which-virtuals-to-apply">It lets you choose which virtuals to apply</a></li>
</ul>
</li>
<li><a href="#changelog">Changelog</a><ul>
<li><a href="#073--2020-11-12">0.7.3 / 2020-11-12</a></li>
<li><a href="#072--2020-10-12">0.7.2 / 2020-10-12</a></li>
<li><a href="#071--2020-10-09">0.7.1 / 2020-10-09</a></li>
<li><a href="#070--2020-10-06">0.7.0 / 2020-10-06</a></li>
<li><a href="#069--2020-08-29">0.6.9 / 2020-08-29</a></li>
<li><a href="#068--2020-06-11">0.6.8 / 2020-06-11</a></li>
<li><a href="#067--2020-06-04">0.6.7 / 2020-06-04</a></li>
<li><a href="#066--2020-06-03">0.6.6 / 2020-06-03</a></li>
<li><a href="#065--2020-06-02">0.6.5 / 2020-06-02</a></li>
<li><a href="#064--2020-06-02">0.6.4 / 2020-06-02</a></li>
<li><a href="#063--2020-05-24">0.6.3 / 2020-05-24</a></li>
<li><a href="#062--2020-04-27">0.6.2 / 2020-04-27</a></li>
<li><a href="#061--2020-03-17">0.6.1 / 2020-03-17</a></li>
<li><a href="#060--2020-03-04">0.6.0 / 2020-03-04</a></li>
<li><a href="#050--2019-10-16">0.5.0 / 2019-10-16</a></li>
<li><a href="#044--2019-09-23">0.4.4 / 2019-09-23</a></li>
<li><a href="#043--2019-06-03">0.4.3 / 2019-06-03</a></li>
<li><a href="#042--2019-05-09">0.4.2 / 2019-05-09</a></li>
<li><a href="#041--2019-05-07">0.4.1 / 2019-05-07</a></li>
<li><a href="#040--2019-04-21">0.4.0 / 2019-04-21</a></li>
<li><a href="#035--2019-03-11">0.3.5 / 2019-03-11</a></li>
<li><a href="#034--2018-11-13">0.3.4 / 2018-11-13</a></li>
<li><a href="#033--2018-11-09">0.3.3 / 2018-11-09</a></li>
<li><a href="#032--2018-10-23">0.3.2 / 2018-10-23</a></li>
<li><a href="#031--2018-10-10">0.3.1 / 2018-10-10</a></li>
<li><a href="#030--2018-01-29">0.3.0 / 2018-01-29</a></li>
</ul>
</li>
</ul>

        <div id="carbonads-wrapper">
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DT537&placement=mongoosejsio" id="_carbonads_js"></script>
        </div>
      </div>
      <h1 id="repo" class="desktop">mongoose-lean-virtuals</h1>
      <div class="toc mobile">
        <h2><a href="/">Mongoose Plugins</a></h2>
        <div>
          <select id="select-plugin-mobile" onchange="window.location.href = '/plugins/' + this.value">
      <option value="autopopulate" >
        mongoose-autopopulate
      </option>
    

      <option value="lean-virtuals" selected>
        mongoose-lean-virtuals
      </option>
    

      <option value="int32" >
        mongoose-int32
      </option>
    

      <option value="double" >
        mongoose-double
      </option>
    

      <option value="update-versioning" >
        mongoose-update-versioning
      </option>
    

      <option value="lean-getters" >
        mongoose-lean-getters
      </option>
    </select>
        </div>
        <ul>
<li><a href="#usage">Usage</a></li>
<li><a href="#examples">examples</a><ul>
<li><a href="#it-attaches-virtuals-to-result-of-find-findone-findbyid-findbyidandupdate-and-findoneandupdate-if-lean">It attaches virtuals to result of find, findOne, findById, findByIdAndUpdate, and findOneAndUpdate if lean</a></li>
<li><a href="#it-lets-you-choose-which-virtuals-to-apply">It lets you choose which virtuals to apply</a></li>
</ul>
</li>
<li><a href="#changelog">Changelog</a><ul>
<li><a href="#073--2020-11-12">0.7.3 / 2020-11-12</a></li>
<li><a href="#072--2020-10-12">0.7.2 / 2020-10-12</a></li>
<li><a href="#071--2020-10-09">0.7.1 / 2020-10-09</a></li>
<li><a href="#070--2020-10-06">0.7.0 / 2020-10-06</a></li>
<li><a href="#069--2020-08-29">0.6.9 / 2020-08-29</a></li>
<li><a href="#068--2020-06-11">0.6.8 / 2020-06-11</a></li>
<li><a href="#067--2020-06-04">0.6.7 / 2020-06-04</a></li>
<li><a href="#066--2020-06-03">0.6.6 / 2020-06-03</a></li>
<li><a href="#065--2020-06-02">0.6.5 / 2020-06-02</a></li>
<li><a href="#064--2020-06-02">0.6.4 / 2020-06-02</a></li>
<li><a href="#063--2020-05-24">0.6.3 / 2020-05-24</a></li>
<li><a href="#062--2020-04-27">0.6.2 / 2020-04-27</a></li>
<li><a href="#061--2020-03-17">0.6.1 / 2020-03-17</a></li>
<li><a href="#060--2020-03-04">0.6.0 / 2020-03-04</a></li>
<li><a href="#050--2019-10-16">0.5.0 / 2019-10-16</a></li>
<li><a href="#044--2019-09-23">0.4.4 / 2019-09-23</a></li>
<li><a href="#043--2019-06-03">0.4.3 / 2019-06-03</a></li>
<li><a href="#042--2019-05-09">0.4.2 / 2019-05-09</a></li>
<li><a href="#041--2019-05-07">0.4.1 / 2019-05-07</a></li>
<li><a href="#040--2019-04-21">0.4.0 / 2019-04-21</a></li>
<li><a href="#035--2019-03-11">0.3.5 / 2019-03-11</a></li>
<li><a href="#034--2018-11-13">0.3.4 / 2018-11-13</a></li>
<li><a href="#033--2018-11-09">0.3.3 / 2018-11-09</a></li>
<li><a href="#032--2018-10-23">0.3.2 / 2018-10-23</a></li>
<li><a href="#031--2018-10-10">0.3.1 / 2018-10-10</a></li>
<li><a href="#030--2018-01-29">0.3.0 / 2018-01-29</a></li>
</ul>
</li>
</ul>

      </div>
      <div class="native-inline">
        <a href="#native_link#"><span class="sponsor">Sponsor</span> #native_company# â€” #native_desc#</a>
      </div>
      <h1 id="usage">Usage</h1>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> mongooseLeanVirtuals = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose-lean-virtuals'</span>);

<span class="hljs-comment">// Example schema</span>
<span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> mongoose.Schema({ <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span> });

userSchema.virtual(<span class="hljs-string">'lowercase'</span>).get(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name.toLowerCase();
});

<span class="hljs-comment">// Now, the `lowercase` property will show up even if you do a lean query</span>
userSchema.plugin(mongooseLeanVirtuals);

<span class="hljs-comment">// Later</span>

<span class="hljs-comment">// You **must** pass `virtuals: true` to `lean()`, otherwise `lowercase`</span>
<span class="hljs-comment">// won't be in `res`</span>
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> UserModel.find().lean({ <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">true</span> });</code></pre>


      

<h1 id="examples">examples</h1>


<h2 id="it-attaches-virtuals-to-result-of-find-findone-findbyid-findbyidandupdate-and-findoneandupdate-if-lean">It attaches virtuals to result of find, findOne, findById, findByIdAndUpdate, and findOneAndUpdate if lean</h2>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> mongoose.Schema({
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span>
});

schema.virtual(<span class="hljs-string">'lowercase'</span>).get(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name.toLowerCase();
});

schema.plugin(mongooseLeanVirtuals);

<span class="hljs-keyword">const</span> Model = mongoose.model(<span class="hljs-string">'Test'</span>, schema);

<span class="hljs-keyword">return</span> Model.create({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Val'</span> }).
  then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">Promise</span>.all([
    <span class="hljs-comment">// You **must** pass `virtuals: true` to `lean()`</span>
    Model.find().lean({ <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">true</span> }),
    Model.findOne().lean({ <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">true</span> }),
    Model.findOneAndUpdate({}, { <span class="hljs-attr">name</span>: <span class="hljs-string">'VAL'</span> }).lean({ <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">true</span> })
  ])).
  then(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> [findRes, findOneRes, findOneAndUpdateRes] = results;
    assert.equal(findRes[<span class="hljs-number">0</span>].lowercase, <span class="hljs-string">'val'</span>);
    assert.equal(findOneRes.lowercase, <span class="hljs-string">'val'</span>);
    assert.equal(findOneAndUpdateRes.lowercase, <span class="hljs-string">'val'</span>);

    <span class="hljs-comment">// Mongoose has an `id` virtual by default that gets the `_id` as a</span>
    <span class="hljs-comment">// string.</span>
    assert.equal(findRes[<span class="hljs-number">0</span>].id, findRes[<span class="hljs-number">0</span>]._id.toString());
    assert.equal(findOneRes.id, findOneRes._id.toString());
    assert.equal(findOneAndUpdateRes.id, findOneAndUpdateRes._id.toString());
  });</code></pre>


<h2 id="it-lets-you-choose-which-virtuals-to-apply">It lets you choose which virtuals to apply</h2>
<p>If you specify a list of virtuals in <code>lean()</code>, this plugin will only
apply those virtuals. This lets you pick which virtuals show up.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> mongoose.Schema({
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span>
}, { <span class="hljs-attr">id</span>: <span class="hljs-literal">false</span> });

schema.virtual(<span class="hljs-string">'lowercase'</span>).get(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name.toLowerCase();
});
schema.virtual(<span class="hljs-string">'uppercase'</span>).get(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name.toUpperCase();
});

schema.plugin(mongooseLeanVirtuals);

<span class="hljs-keyword">const</span> Model = mongoose.model(<span class="hljs-string">'Test2'</span>, schema);

<span class="hljs-keyword">return</span> Model.create({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Val'</span> }).
  then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> Model.findOne().lean({ <span class="hljs-attr">virtuals</span>: [<span class="hljs-string">'uppercase'</span>] })).
  then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
    assert.equal(result.uppercase, <span class="hljs-string">'VAL'</span>);
    assert.ok(!result.lowercase);
  });</code></pre>


      <h1 id="changelog">Changelog</h1>
<h2 id="073--2020-11-12">0.7.3 / 2020-11-12</h2>
<ul>
<li>fix: skip non-existent virtuals when passing a list of virtual names to <code>lean()</code> #42</li>
</ul>
<h2 id="072--2020-10-12">0.7.2 / 2020-10-12</h2>
<ul>
<li>fix: make <code>parent()</code> tracking support case where array of subdocs contains primitives #41</li>
</ul>
<h2 id="071--2020-10-09">0.7.1 / 2020-10-09</h2>
<ul>
<li>fix: avoid WeakMap error when using arrays with <code>null</code> elements #41</li>
</ul>
<h2 id="070--2020-10-06">0.7.0 / 2020-10-06</h2>
<ul>
<li>feat: add top-level <code>parent()</code> function that lets you get the subdocument&#39;s parent even though the subdoc is lean #40</li>
</ul>
<h2 id="069--2020-08-29">0.6.9 / 2020-08-29</h2>
<ul>
<li>fix: avoid TypeError when there are multiple discriminators #39</li>
</ul>
<h2 id="068--2020-06-11">0.6.8 / 2020-06-11</h2>
<ul>
<li>fix: apply virtuals in doubly nested document arrays #38</li>
</ul>
<h2 id="067--2020-06-04">0.6.7 / 2020-06-04</h2>
<ul>
<li>fix build for node v6 and v4</li>
</ul>
<h2 id="066--2020-06-03">0.6.6 / 2020-06-03</h2>
<ul>
<li>fix: discriminators when the query result is an array #37 #36 <a href="https://github.com/FERNman">FERNman</a></li>
</ul>
<h2 id="065--2020-06-02">0.6.5 / 2020-06-02</h2>
<ul>
<li>fix: avoid infinite recursion on recursive schemas with virtuals #33</li>
</ul>
<h2 id="064--2020-06-02">0.6.4 / 2020-06-02</h2>
<ul>
<li>fix: allow explicitly selecting subdocument virtuals #35 #34 <a href="https://github.com/ChrisLahaye">ChrisLahaye</a></li>
</ul>
<h2 id="063--2020-05-24">0.6.3 / 2020-05-24</h2>
<ul>
<li>fix: skip checking discriminators if result is null #32</li>
</ul>
<h2 id="062--2020-04-27">0.6.2 / 2020-04-27</h2>
<ul>
<li>fix: correctly pass existing field value to applyGetters #31 <a href="https://github.com/makinde">makinde</a></li>
</ul>
<h2 id="061--2020-03-17">0.6.1 / 2020-03-17</h2>
<ul>
<li>fix: get virtuals from discriminator schema if discriminator key set #30 <a href="https://github.com/makinde">makinde</a></li>
</ul>
<h2 id="060--2020-03-04">0.6.0 / 2020-03-04</h2>
<ul>
<li>feat: attach lean virtuals to result of <code>findOneAndRemove()</code> and <code>findOneAndDelete()</code> #29 <a href="https://github.com/isaacdecoded">isaacdecoded</a></li>
</ul>
<h2 id="050--2019-10-16">0.5.0 / 2019-10-16</h2>
<ul>
<li>fix: use post order traversal so child schema virtuals are set before parent schema #28</li>
</ul>
<h2 id="044--2019-09-23">0.4.4 / 2019-09-23</h2>
<ul>
<li>fix: check for empty path #26 <a href="https://github.com/thoglen">thoglen</a></li>
</ul>
<h2 id="043--2019-06-03">0.4.3 / 2019-06-03</h2>
<ul>
<li>fix: avoid trying to virtualize undefined doc #24 <a href="https://github.com/AlexandreGymlib">AlexandreGymlib</a></li>
</ul>
<h2 id="042--2019-05-09">0.4.2 / 2019-05-09</h2>
<ul>
<li>fix: handle virtuals in nested schemas with find() #22</li>
</ul>
<h2 id="041--2019-05-07">0.4.1 / 2019-05-07</h2>
<ul>
<li>fix: support Mongoose 5.x cursors #21</li>
</ul>
<h2 id="040--2019-04-21">0.4.0 / 2019-04-21</h2>
<ul>
<li>feat: support virtuals in nested schemas #20</li>
</ul>
<h2 id="035--2019-03-11">0.3.5 / 2019-03-11</h2>
<ul>
<li>fix: support <code>ref</code> in virtual options #19 <a href="https://github.com/linusbrolin">linusbrolin</a></li>
</ul>
<h2 id="034--2018-11-13">0.3.4 / 2018-11-13</h2>
<ul>
<li>fix: attach all virtuals as opposed to just one #14 <a href="https://github.com/artemkobets">artemkobets</a></li>
</ul>
<h2 id="033--2018-11-09">0.3.3 / 2018-11-09</h2>
<ul>
<li>fix: fix one more issue with <code>eachAsync()</code> #12 <a href="https://github.com/nico29">nico29</a></li>
</ul>
<h2 id="032--2018-10-23">0.3.2 / 2018-10-23</h2>
<ul>
<li>fix: support Mongoose cursor&#39;s <code>eachAsync()</code> #9</li>
</ul>
<h2 id="031--2018-10-10">0.3.1 / 2018-10-10</h2>
<ul>
<li>docs: link to new docs site on plugins.mongoosejs.io</li>
</ul>
<h2 id="030--2018-01-29">0.3.0 / 2018-01-29</h2>
<ul>
<li>fix: delay checking virtuals until the middleware for 5.0 support #6</li>
</ul>

    </div>
  
    </div>
  </body>
</html>
